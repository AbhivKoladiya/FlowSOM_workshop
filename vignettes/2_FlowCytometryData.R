## ------------------------------------------------------------------------
library(flowCore)
library(flowDensity)
library(flowWorkspace)
library(FlowSOM)
library(FlowSOMworkshop)

## ------------------------------------------------------------------------
wsp_file <- "../inst/extdata/manualGating.wsp"
fcs_file <- "../inst/extdata/21-10-15_Tube_011.fcs"

## ------------------------------------------------------------------------
fcs_file <- "../inst/extdata/21-10-15_Tube_028.fcs"

## ------------------------------------------------------------------------
flowjo_res <- parse_flowjo(fcs_file, wsp_file, plot = TRUE)

## ------------------------------------------------------------------------
ff <- flowjo_res$flowFrame
gates <- flowjo_res$gates

## ------------------------------------------------------------------------
nrow(ff)

## ------------------------------------------------------------------------
colnames(ff)

## ------------------------------------------------------------------------
get_markers(ff, colnames(ff))

## ------------------------------------------------------------------------
get_channels(ff, "CD3")

## ------------------------------------------------------------------------
head(ff@exprs)

## ------------------------------------------------------------------------
head(ff@description, n = 20)

## ------------------------------------------------------------------------
ff@description$`$DATE`
ff@description$`$CYT`

## ------------------------------------------------------------------------
ncol(ff)

## ------------------------------------------------------------------------
ff@exprs[150, ]

## ------------------------------------------------------------------------
get_channels(ff, "CD19")

## ------------------------------------------------------------------------
ff@exprs[1:6, get_channels(ff, "CD19")]

## ------------------------------------------------------------------------
median(ff@exprs[, get_channels(ff, "CD19")])

## ------------------------------------------------------------------------
ff@description$`$BTIM`

## ------------------------------------------------------------------------
head(gates)

## ------------------------------------------------------------------------
colSums(gates)

## ------------------------------------------------------------------------
data_live <- gating_subset(flowjo_res, "Live")

## ------------------------------------------------------------------------
nrow(data_live$flowFrame)

## ------------------------------------------------------------------------
channels_to_plot <- get_channels(ff, c("CD64", "AmCyan-A"))

plotDens(data_live$flowFrame, 
         channels_to_plot)

## ------------------------------------------------------------------------
data_B <- gating_subset(flowjo_res, "B cells")
channels_to_plot <- get_channels(ff, c("CD3", "CD19"))
plotDens(data_B$flowFrame, 
         channels_to_plot)

## ------------------------------------------------------------------------
color_macrophages <- c("black", "red")[1 + data_live$gates[,"Macrophages"]]
head(color_macrophages, n = 10)

## ------------------------------------------------------------------------
channels_to_plot <- get_channels(ff, c("CD64", "AmCyan-A"))

plotDens(data_live$flowFrame, 
         channels_to_plot,
         col = color_macrophages)

## ------------------------------------------------------------------------
color_B <- c("black", "blue")[1 + data_live$gates[,"B cells"]]

channels_to_plot <- get_channels(ff, c("CD3", "CD19"))

plotDens(data_live$flowFrame, 
         channels_to_plot,
         col = color_B)

